import{Q as L,_ as M}from"./AppLayout.vue_vue_type_script_setup_true_lang-R4kQx9DT.js";import{A as S,r as v,a as V,b as m,d as s,e as o,h as T,w as l,f as a,m as b,k as d,j as c,t as f,F as k,z as F,i as C,l as H,n as U,B as O,x as X}from"./app-CYSvmcR8.js";import{c as G,_ as E}from"./AppFooter-DaHgPrIF.js";import{_ as I,a as P,b as $}from"./CardHeader.vue_vue_type_script_setup_true_lang-CazDfcUj.js";import{_ as J}from"./CardDescription.vue_vue_type_script_setup_true_lang-B-VIl_s4.js";import{_ as B}from"./CardTitle.vue_vue_type_script_setup_true_lang-Zu7LdWln.js";import{_ as K}from"./index-DbHijLDh.js";import{s as Q,e as R}from"./useSweetAlert-DaBq0Crb.js";import{C as w}from"./ThemeSwitcher.vue_vue_type_script_setup_true_lang-RQb2PAcX.js";import{C as q}from"./circle-check-big-Bb_2xxKT.js";import{C as W}from"./circle-x-jSX6WCdp.js";import"./useForwardExpose-C04IyDGt.js";import"./RovingFocusGroup-CF_7D-JK.js";import"./VisuallyHidden-BhR3rBEy.js";import"./sweetalert2.esm.all-NNS-RXd7.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=G("RefreshCwIcon",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),Z={class:"py-12"},tt={class:"mx-auto max-w-7xl sm:px-6 lg:px-8 space-y-6"},at={key:0,class:"flex justify-center mb-6"},et={class:"bg-white p-4 rounded-lg shadow-sm"},st=["src"],ot={class:"text-sm text-muted-foreground text-center"},lt={class:"font-mono"},nt={class:"flex items-center text-sm text-yellow-600 animate-pulse"},rt={class:"rounded-md border"},it={class:"w-full text-sm text-left"},dt={class:"p-3 font-mono"},ct={class:"p-3"},ut={class:"p-3 font-bold"},mt={class:"p-3"},ft={class:"p-3"},_t={class:"p-3 text-right"},pt={key:0},Rt={__name:"Index",props:{pagos:Array},setup(g){const A=g,D=S(),r=v(D.props.flash?.qr_data||null),_=v(!1),u=v(null),z=n=>{r.value={qrBase64:n.qr_image,transactionId:n.pagofacil_transaction_id},window.scrollTo({top:0,behavior:"smooth"}),j(n.pagofacil_transaction_id)},h=v(null),N=async n=>{h.value=n.id,_.value=!0;try{const e=(await O.get(`/pagos/consultar/${n.id}`)).data;if(e.status==="success"){const i=e.data.paymentStatus;n.estado=i;let p="El estado se ha actualizado.";i==2&&(p="¡Pago confirmado exitosamente!"),i==4&&(p="El pago ha sido anulado."),i==5&&(p="El pago está en revisión."),Q({title:"Estado Actualizado",text:p}),i==2&&r.value?.transactionId==n.pagofacil_transaction_id&&(r.value=null,y())}else R({title:"Error",text:e.message||"No se pudo consultar el estado."})}catch(t){console.error(t),R({title:"Error",text:"Ocurrió un error al consultar el servicio."})}finally{_.value=!1,h.value=null}},x=n=>{switch(parseInt(n)){case 1:return{variant:"secondary",label:"Pendiente",icon:w};case 2:return{variant:"default",label:"Pagado",icon:q};case 4:return{variant:"destructive",label:"Anulado",icon:W};case 5:return{variant:"default",label:"Pagada - Revisión",icon:q};default:return{variant:"outline",label:"Desconocido",icon:w}}},j=n=>{u.value&&clearInterval(u.value),u.value=setInterval(async()=>{try{X.reload({only:["pagos"],onSuccess:()=>{const t=A.pagos.find(e=>e.pagofacil_transaction_id==n);t&&t.estado==2&&(y(),Q({title:"¡Pago Exitoso!",text:"Tu pago ha sido confirmado."}),r.value=null)}})}catch(t){console.error(t)}},5e3)},y=()=>{u.value&&(clearInterval(u.value),u.value=null)};return V(()=>{y()}),(n,t)=>(d(),m(k,null,[s(o(T),{title:"Pagos QR"}),s(M,null,{header:l(()=>[...t[0]||(t[0]=[a("h2",{class:"text-xl font-semibold leading-tight text-foreground"}," Pagos con QR ",-1)])]),default:l(()=>[a("div",Z,[a("div",tt,[r.value?(d(),m("div",at,[s(o(I),{class:"w-full max-w-md border-primary border-2"},{default:l(()=>[s(o(P),null,{default:l(()=>[s(o(B),{class:"text-center text-primary"},{default:l(()=>[...t[1]||(t[1]=[c("¡Escanea para Pagar!",-1)])]),_:1}),s(o(J),{class:"text-center"},{default:l(()=>[...t[2]||(t[2]=[c("Usa tu aplicación bancaria favorita",-1)])]),_:1})]),_:1}),s(o($),{class:"flex flex-col items-center justify-center space-y-4"},{default:l(()=>[a("div",et,[a("img",{src:`data:image/png;base64,${r.value.qrBase64}`,alt:"QR de Pago",class:"w-64 h-64 object-contain"},null,8,st)]),a("p",ot,[t[3]||(t[3]=c(" ID Transacción: ",-1)),a("span",lt,f(r.value.transactionId),1)]),a("div",nt,[s(o(w),{class:"mr-2 h-4 w-4"}),t[4]||(t[4]=c(" Esperando confirmación de pago... ",-1))])]),_:1})]),_:1})])):b("",!0),s(o(I),null,{default:l(()=>[s(o(P),null,{default:l(()=>[s(o(B),null,{default:l(()=>[...t[5]||(t[5]=[c("Historial de Pagos",-1)])]),_:1})]),_:1}),s(o($),null,{default:l(()=>[a("div",rt,[a("table",it,[t[8]||(t[8]=a("thead",{class:"bg-muted text-muted-foreground"},[a("tr",null,[a("th",{class:"p-3 font-medium"},"ID Pedido"),a("th",{class:"p-3 font-medium"},"Fecha"),a("th",{class:"p-3 font-medium"},"Monto"),a("th",{class:"p-3 font-medium"},"Estado"),a("th",{class:"p-3 font-medium"},"QR"),a("th",{class:"p-3 font-medium text-right"},"Acciones")])],-1)),a("tbody",null,[(d(!0),m(k,null,F(g.pagos,e=>(d(),m("tr",{key:e.id,class:"border-t hover:bg-muted/50"},[a("td",dt,f(e.pedido_id),1),a("td",ct,f(new Date(e.created_at).toLocaleString()),1),a("td",ut,"Bs "+f(e.monto),1),a("td",mt,[s(o(K),{variant:x(e.estado).variant},{default:l(()=>[(d(),C(H(x(e.estado).icon),{class:"mr-1 h-3 w-3"})),c(" "+f(x(e.estado).label),1)]),_:2},1032,["variant"])]),a("td",ft,[e.estado==1&&e.qr_image?(d(),C(o(E),{key:0,variant:"outline",size:"sm",onClick:i=>z(e)},{default:l(()=>[s(o(L),{class:"h-4 w-4 mr-1"}),t[6]||(t[6]=c(" Ver QR ",-1))]),_:1},8,["onClick"])):b("",!0)]),a("td",_t,[s(o(E),{variant:"ghost",size:"sm",disabled:_.value,onClick:i=>N(e)},{default:l(()=>[s(o(Y),{class:U(["h-4 w-4",{"animate-spin":_.value&&h.value===e.id}])},null,8,["class"])]),_:2},1032,["disabled","onClick"])])]))),128)),g.pagos.length===0?(d(),m("tr",pt,[...t[7]||(t[7]=[a("td",{colspan:"6",class:"p-6 text-center text-muted-foreground"}," No hay pagos registrados. ",-1)])])):b("",!0)])])])]),_:1})]),_:1})])])]),_:1})],64))}};export{Rt as default};
